<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calendar Summarizer</title>
  <style>
    :root {
      --bg: #101624;
      --card: #181f2f;
      --muted: #a3adc2;
      --accent: #7c5cff;
      --accent-glow: 0 0 24px #7c5cff88;
      --glass: rgba(255,255,255,0.03);
      --radius: 18px;
      --shadow: 0 12px 48px rgba(20,30,60,0.18), 0 2px 12px rgba(124,92,255,0.10);
    }
    * { box-sizing: border-box; font-family: 'Inter', 'Segoe UI', Arial, sans-serif; }
    html, body { height: 100%; margin: 0; background: linear-gradient(180deg, #0b1220 0%, #101624 100%); color: #e6eef8; }
    body { min-height: 100vh; }
    .container {
      max-width: 900px;
      margin: 64px auto 40px auto;
      padding: 0 32px;
      display: flex;
      flex-direction: column;
      gap: 36px;
    }
    .header {
      text-align: center;
      margin-bottom: 0;
      position: relative;
    }
    .header h1 {
      font-size: 3.2rem;
      font-weight: 900;
      margin: 0;
      letter-spacing: -1.5px;
      color: #fff;
      text-shadow: var(--accent-glow), 0 4px 24px #232a3d;
      position: relative;
      z-index: 1;
      background: linear-gradient(90deg, var(--accent), #5b9bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .accent-bar {
      width: 120px;
      height: 8px;
      background: linear-gradient(90deg, var(--accent), #5b9bff);
      border-radius: 4px;
      margin: 18px auto 0 auto;
      box-shadow: 0 0 18px #7c5cff55;
    }
    .tagline {
      margin: 24px 0 0 0;
      color: var(--muted);
      font-size: 1.25rem;
      font-weight: 400;
      letter-spacing: 0.1px;
    }
    .horizontal-section {
      display: flex;
      gap: 32px;
      justify-content: center;
      align-items: flex-start;
      margin-bottom: 0;
      flex-wrap: wrap;
    }
    .calendar-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      padding: 32px 28px 24px 28px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.05);
      transition: box-shadow 0.2s;
      min-width: 340px;
      max-width: 420px;
      flex: 1 1 340px;
    }
    .calendar-title {
      text-align: left;
      font-size: 1.45rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 18px;
      letter-spacing: 0.2px;
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 1.15rem;
    }
    .calendar-nav button {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.3rem;
      cursor: pointer;
      padding: 4px 14px;
      border-radius: 8px;
      transition: background 0.18s;
    }
    .calendar-nav button:hover {
      background: #7c5cff22;
    }
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 4px;
      font-size: 1.15rem;
    }
    .calendar-table th, .calendar-table td {
      width: 14.28%;
      text-align: center;
      padding: 12px 0;
      font-size: 1.08rem;
      border-radius: 8px;
      transition: background 0.18s, color 0.18s;
    }
    .calendar-table th {
      color: var(--muted);
      font-weight: 600;
      font-size: 1.05rem;
      background: none;
    }
    .calendar-table td {
      cursor: pointer;
      background: none;
      color: #e6eef8;
    }
    .calendar-table td.today {
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      box-shadow: 0 0 12px #7c5cff44;
    }
    .calendar-table td.selected {
      background: #5b9bff;
      color: #fff;
      font-weight: 700;
    }
    .calendar-table td:hover {
      background: #7c5cff33;
    }
    .calendar-table td.inactive {
      color: #7c5cff55;
      cursor: default;
    }
    .calendar-selected-date {
      margin-top: 14px;
      color: var(--accent);
      font-size: 1.08rem;
      text-align: center;
      min-height: 22px;
    }
    .ics-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      padding: 32px 28px 24px 28px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.05);
      min-width: 260px;
      max-width: 340px;
      flex: 1 1 260px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      align-items: stretch;
      justify-content: flex-start;
    }
    .ics-title {
      font-size: 1.18rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 18px;
      letter-spacing: 0.2px;
      text-align: left;
    }
    .ics-field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .ics-label {
      font-size: 1.15rem;
      color: var(--muted);
      margin-bottom: 2px;
      font-weight: 600;
    }
    input[type=file] {
      padding: 12px;
      background: var(--glass);
      border-radius: 10px;
      border: 1.5px dashed #7c5cff33;
      color: var(--muted);
      font-size: 1.08rem;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      padding: 38px 32px 32px 32px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.05);
      margin-bottom: 0;
      transition: box-shadow 0.2s;
      min-width: 340px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .card:focus-within, .card:hover {
      box-shadow: 0 16px 56px rgba(124,92,255,0.13), var(--shadow);
      border-color: #7c5cff33;
    }
    .form { display: flex; flex-direction: column; gap: 24px; }
    .field { display: flex; flex-direction: column; gap: 8px; }
    .label { font-size: 1.15rem; color: var(--muted); margin-bottom: 2px; font-weight: 600; }
    textarea {
      resize: vertical;
      min-height: 120px;
      padding: 16px;
      border-radius: 10px;
      background: rgba(0,0,0,0.22);
      border: 1.5px solid #7c5cff22;
      color: inherit;
      font-size: 1.15rem;
      transition: border 0.2s;
    }
    textarea:focus { border-color: var(--accent); outline: none; }
    .actions { display: flex; gap: 18px; margin-top: 12px; }
    .btn {
      padding: 14px 28px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, #232a3d 0%, #181f2f 100%);
      color: #e6eef8;
      font-weight: 600;
      font-size: 1.15rem;
      cursor: pointer;
      box-shadow: 0 2px 12px #7c5cff11;
      transition: background 0.18s, box-shadow 0.18s;
    }
    .btn.primary {
      background: linear-gradient(90deg, var(--accent), #5b9bff);
      color: #fff;
      box-shadow: 0 4px 24px #7c5cff33;
      font-weight: 700;
    }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .status {
      margin-top: 18px;
      color: var(--muted);
      font-size: 1.08rem;
      min-height: 22px;
      transition: color 0.2s;
    }
    .status.error { color: #ffb4b4; }
    .result {
      margin-top: 24px;
      background: rgba(255,255,255,0.03);
      padding: 22px;
      border-radius: 12px;
      border: 1.5px solid #7c5cff22;
      box-shadow: 0 2px 12px #7c5cff11;
      font-size: 1.15rem;
      word-break: break-word;
      min-height: 80px;
    }
    .result h2 { margin: 0 0 12px 0; font-size: 1.18rem; color: var(--accent); }
    .result pre {
      white-space: pre-wrap;
      margin: 0;
      font-family: 'Fira Mono', 'Roboto Mono', 'Menlo', monospace;
      font-size: 1.08rem;
      color: #dbeafe;
    }
    .footer {
      margin-top: 32px;
      color: var(--muted);
      font-size: 1.08rem;
      text-align: center;
      opacity: 0.85;
    }
    /* Chatbox styles */
    .chatbox-container {
      position: fixed;
      right: 32px;
      bottom: 32px;
      width: 400px;
      max-width: 98vw;
      z-index: 100;
      font-size: 1.08rem;
    }
    .chatbox {
      background: linear-gradient(180deg, #181f2f 80%, #232a3d 100%);
      border-radius: 20px;
      box-shadow: 0 12px 48px #000a  , 0 2px 12px #7c5cff22;
      border: 1.5px solid #7c5cff22;
      padding: 24px 20px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      min-height: 120px;
      max-height: 420px;
      overflow-y: auto;
    }
    .chatbox-title {
      font-size: 1.18rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
      text-align: left;
      letter-spacing: 0.2px;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 8px;
      max-height: 220px;
      font-size: 1.08rem;
    }
    .chat-message {
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .chat-user {
      color: #fff;
      font-weight: 600;
      font-size: 1.08rem;
      margin-bottom: 2px;
    }
    .chat-ai {
      color: var(--accent);
      font-size: 1.08rem;
      margin-bottom: 2px;
    }
    .chatbox-form {
      display: flex;
      gap: 10px;
      margin-top: 2px;
    }
    .chatbox-input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 1.5px solid #7c5cff22;
      background: #101624;
      color: #e6eef8;
      font-size: 1.08rem;
      outline: none;
      transition: border 0.18s;
    }
    .chatbox-input:focus { border-color: var(--accent); }
    .chatbox-send {
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, var(--accent), #5b9bff);
      color: #fff;
      font-weight: 700;
      font-size: 1.08rem;
      cursor: pointer;
      box-shadow: 0 2px 12px #7c5cff11;
      transition: background 0.18s;
    }
    @media (max-width: 900px) {
      .container { max-width: 100vw; padding: 0 8px; }
      .horizontal-section { gap: 12px; }
      .calendar-card, .ics-card, .card { max-width: 98vw; }
      .chatbox-container { right: 8px; bottom: 8px; width: 98vw; }
    }
    @media (max-width: 700px) {
      .horizontal-section { flex-direction: column; gap: 18px; }
      .calendar-card, .ics-card { min-width: 0; max-width: 100vw; }
    }
    @media (max-width: 640px) {
      .container { margin: 18px auto 12px auto; padding: 0 4px; gap: 18px; }
      .header h1 { font-size: 1.5rem; }
      .calendar-card, .ics-card, .card { padding: 12px 4px; }
      .chatbox-container { right: 4px; bottom: 4px; width: 98vw; }
      .chatbox { padding: 10px 4px; }
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="header">
      <h1>Calendar Summarizer</h1>
      <div class="accent-bar"></div>
      <p class="tagline">Upload an ICS file or type a prompt to generate a summary using the backend service.</p>
    </header>

    <!-- Horizontal Calendar + ICS Uploader -->
    <section class="horizontal-section">
      <div class="calendar-card" id="calendarCard">
        <div class="calendar-title">Calendar</div>
        <div class="calendar-nav">
          <button id="prevMonth" title="Previous Month">&#8592;</button>
          <span id="calendarMonth"></span>
          <button id="nextMonth" title="Next Month">&#8594;</button>
        </div>
        <table class="calendar-table" id="calendarTable">
          <!-- Calendar will be rendered here -->
        </table>
        <div class="calendar-selected-date" id="calendarSelectedDate"></div>
      </div>
      <div class="ics-card">
        <div class="ics-title">ICS File Uploader</div>
        <div class="ics-field">
          <label class="ics-label" for="icsFile">ICS file (optional)</label>
          <input id="icsFile" name="icsFile" type="file" accept=".ics">
        </div>
      </div>
    </section>

    <section class="card">
      <form id="generateForm" class="form" autocomplete="off">
        <label class="field">
          <span class="label">Prompt (optional)</span>
          <textarea id="prompt" name="prompt" rows="6" placeholder="Summarize my upcoming week... or leave blank to summarize the uploaded ICS file"></textarea>
        </label>
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn primary">Generate</button>
          <button id="clearBtn" type="button" class="btn">Clear</button>
        </div>
      </form>
      <div id="status" class="status" aria-live="polite"></div>
      <div id="result" class="result" hidden>
        <h2>Result</h2>
        <pre id="resultText"></pre>
      </div>
    </section>

    <footer class="footer">
      <small>Tip: If your Java app doesn't expose an HTTP endpoint yet, set up a small controller to accept multipart POSTs at the endpoint configured in the script below.</small>
    </footer>
  </main>

  <!-- AI Chatbox -->
  <div class="chatbox-container">
    <div class="chatbox" id="chatbox">
      <div class="chatbox-title">AI Chat</div>
      <div class="chat-messages" id="chatMessages"></div>
      <form class="chatbox-form" id="chatboxForm" autocomplete="off">
        <input type="text" class="chatbox-input" id="chatboxInput" placeholder="Type a message..." required>
        <button type="submit" class="chatbox-send">Send</button>
      </form>
    </div>
  </div>

  <script>
    // Backend endpoint for main form
    const ENDPOINT = '/generate'; // Change if needed

    // Main form logic
    const form = document.getElementById('generateForm');
    const icsFileEl = document.getElementById('icsFile');
    const promptEl = document.getElementById('prompt');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');
    const resultText = document.getElementById('resultText');

    function setStatus(text, isError = false) {
      statusEl.textContent = text;
      statusEl.classList.toggle('error', isError);
    }

    clearBtn.addEventListener('click', () => {
      promptEl.value = '';
      icsFileEl.value = '';
      resultEl.hidden = true;
      resultText.textContent = '';
      setStatus('Cleared.');
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultEl.hidden = true;
      resultText.textContent = '';

      const formData = new FormData();
      const file = icsFileEl.files[0];
      const prompt = promptEl.value.trim();

      if (file) formData.append('icsFile', file);
      if (prompt) formData.append('prompt', prompt);

      if (!file && !prompt) {
        setStatus('Please provide an .ics file or a prompt.', true);
        return;
      }

      submitBtn.disabled = true;
      setStatus('Sending request...');

      try {
        const resp = await fetch(ENDPOINT, {
          method: 'POST',
          body: formData
        });

        if (!resp.ok) {
          const text = await resp.text().catch(() => resp.statusText);
          throw new Error(text || `Server returned ${resp.status}`);
        }

        let bodyText;
        try {
          bodyText = await resp.text();
        } catch (err) {
          const json = await resp.json();
          bodyText = JSON.stringify(json, null, 2);
        }

        resultText.textContent = bodyText;
        resultEl.hidden = false;
        setStatus('Done.');
      } catch (err) {
        console.error(err);
        setStatus('Request failed: ' + (err.message || err), true);
      } finally {
        submitBtn.disabled = false;
      }
    });

    // --- AI Chatbox logic ---
    const chatMessages = document.getElementById('chatMessages');
    const chatboxForm = document.getElementById('chatboxForm');
    const chatboxInput = document.getElementById('chatboxInput');

    // Change this to your backend chat endpoint if available
    const CHAT_ENDPOINT = '/chat';

    function addMessage(text, sender = 'user') {
      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-message';
      if (sender === 'user') {
        msgDiv.innerHTML = `<div class="chat-user">You</div><div>${text}</div>`;
      } else {
        msgDiv.innerHTML = `<div class="chat-ai">AI</div><div>${text}</div>`;
      }
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    chatboxForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userText = chatboxInput.value.trim();
      if (!userText) return;
      addMessage(userText, 'user');
      chatboxInput.value = '';
      // Show loading AI message
      addMessage('...', 'ai');

      // Replace with real backend call if available
      try {
        // Example: POST to /chat with {message: userText}
        const resp = await fetch(CHAT_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userText })
        });
        let aiText = '';
        if (resp.ok) {
          aiText = await resp.text();
        } else {
          aiText = 'AI is unavailable (mock response).';
        }
        // Remove loading message
        chatMessages.lastChild.remove();
        addMessage(aiText, 'ai');
      } catch (err) {
        chatMessages.lastChild.remove();
        addMessage('AI is unavailable (mock response).', 'ai');
      }
    });

    // --- Calendar Widget Logic ---
    const calendarTable = document.getElementById('calendarTable');
    const calendarMonth = document.getElementById('calendarMonth');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const calendarSelectedDate = document.getElementById('calendarSelectedDate');

    let today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();
    let selectedDay = null;

    function renderCalendar(month, year) {
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      // Month name
      const monthNames = [
        'January','February','March','April','May','June',
        'July','August','September','October','November','December'
      ];
      calendarMonth.textContent = `${monthNames[month]} ${year}`;

      // Table header
      let html = '<tr>';
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d => {
        html += `<th>${d}</th>`;
      });
      html += '</tr><tr>';

      // Fill blanks before first day
      for (let i = 0; i < startDay; i++) {
        html += '<td class="inactive"></td>';
      }

      // Fill days
      for (let day = 1; day <= daysInMonth; day++) {
        const dateObj = new Date(year, month, day);
        let classes = [];
        if (
          dateObj.getDate() === today.getDate() &&
          dateObj.getMonth() === today.getMonth() &&
          dateObj.getFullYear() === today.getFullYear()
        ) {
          classes.push('today');
        }
        if (
          selectedDay &&
          dateObj.getDate() === selectedDay.getDate() &&
          dateObj.getMonth() === selectedDay.getMonth() &&
          dateObj.getFullYear() === selectedDay.getFullYear()
        ) {
          classes.push('selected');
        }
        html += `<td class="${classes.join(' ')}" data-day="${day}">${day}</td>`;
        if ((startDay + day) % 7 === 0 && day !== daysInMonth) html += '</tr><tr>';
      }

      // Fill blanks after last day
      const endDay = (startDay + daysInMonth) % 7;
      if (endDay !== 0) {
        for (let i = endDay; i < 7; i++) {
          html += '<td class="inactive"></td>';
        }
      }
      html += '</tr>';
      calendarTable.innerHTML = html;
    }

    function updateSelectedDateDisplay() {
      if (selectedDay) {
        calendarSelectedDate.textContent =
          `Selected: ${selectedDay.toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'})}`;
      } else {
        calendarSelectedDate.textContent = '';
      }
    }

    calendarTable.addEventListener('click', function(e) {
      if (e.target.tagName === 'TD' && !e.target.classList.contains('inactive')) {
        const day = parseInt(e.target.getAttribute('data-day'), 10);
        selectedDay = new Date(currentYear, currentMonth, day);
        renderCalendar(currentMonth, currentYear);
        updateSelectedDateDisplay();
      }
    });

    prevMonthBtn.addEventListener('click', function() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar(currentMonth, currentYear);
      updateSelectedDateDisplay();
    });

    nextMonthBtn.addEventListener('click', function() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentMonth, currentYear);
      updateSelectedDateDisplay();
    });

    // Initial render
    renderCalendar(currentMonth, currentYear);
    updateSelectedDateDisplay();
  </script>
</body>
</html>